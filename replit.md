# لعبة تخمين الأرقام العربية

## نظرة عامة

لعبة تخمين أرقام تفاعلية عربية مع واجهة 2D حديثة. اللاعبون يخمنون رقماً سرياً ويتلقون تعليقات على دقة التخمين. تدعم اللعبة الوضع الفردي والجماعي مع تواصل فوري عبر WebSocket وتحديات صغيرة للحصول على تلميحات. اللعبة مصممة للعمل على الهاتف والحاسوب بسلاسة.

## تفضيلات المستخدم

أسلوب التواصل المفضل: لغة بسيطة وسهلة الفهم.

## البنية المعمارية

### الواجهة الأمامية (Frontend)

**مجموعة التقنيات:**
- React 18 مع TypeScript
- Vite للبناء والتطوير
- TailwindCSS للتصميم
- Radix UI للمكونات الأساسية
- Zustand لإدارة الحالة

**استراتيجية العرض:**
- **ديسكتوب**: واجهة كاملة مع لوحة المحاولات السابقة على الجانب
- **موبايل**: واجهة محسنة مع لوحة أرقام مخصصة، كشف تلقائي عند 768px

**المكونات الرئيسية:**
- `MobileSingleplayer` و `DesktopSingleplayer`: واجهات اللعب الفردي
- `MultiplayerLobby`: غرفة انتظار اللعب الجماعي
- `MultiplayerGame2D`: واجهة اللعب الجماعي
- `RainDropsChallenge`, `DirectionChallenge`, `MemoryChallenge`, `PatternChallenge`: التحديات الأربعة
- `CardSystem`: نظام البطاقات الحصري للعب الجماعي

**إدارة الحالة:**
- `useNumberGame`: الحالة الرئيسية للعبة (وضع فردي وجماعي)
- `useChallenges`: حالة التحديات والتلميحات
- `useCards`: نظام البطاقات الخاص
- `useAudio`: إدارة المؤثرات الصوتية

**التواصل بين العميل والخادم:**
- WebSocket للعب الجماعي الفوري
- حفظ الجلسة عبر sessionStorage للاتصال المفقود
- رسائل: challenge_player, set_secret_code, make_guess, turn_timeout, وغيرها

### الخادم (Backend)

**مجموعة التقنيات:**
- Express.js مع TypeScript
- WebSocket (ws) للتواصل الفوري
- Neon PostgreSQL مع Drizzle ORM (متوفر للاستخدام المستقبلي)

**بنية الخادم:**
- `server/index.ts`: إعداد Express والـ middleware
- `server/routes.ts`: خادم WebSocket ومنطق اللعبة
- `server/db.ts`: اتصال قاعدة البيانات
- `server/storage.ts`: واجهة التخزين (في الذاكرة حالياً)

**منطق اللعبة:**
- نظام غرف مع معرفات فريدة
- لعب مستقل وفوري (الاثنان يلعبان بنفس الوقت)
- أكواز سرية مشتركة تولد تلقائياً
- نظام إعادة اتصال شامل:
  - تخزين اللاعبين المقطوعين مع timeout 5 دقائق
  - حفظ بيانات اللعبة (المحاولات والنقاط)
  - تنظيف تلقائي للغرف المهجورة
  - مزامنة حالة اللعبة بين جميع العملاء

## تخزين البيانات

**قاعدة البيانات:**
- PostgreSQL عبر Neon (مُعد لكن لم يُستخدم بالكامل بعد)
- Drizzle ORM لاستعلامات آمنة

**إدارة الجلسات:**
- تتبع اتصالات WebSocket لكل لاعب
- حالة الغرفة محفوظة في ذاكرة الخادم (Map)
- تخزين الجلسة محلي للاتصال بعد التحديث (انتهاء الصلاحية بعد 30 دقيقة)
- انقطاع 5 دقائق للاعبين المقطوعين في الألعاب النشطة

## اختيارات التصميم النظامي

**تجربة المستخدم:**
- تصميم متجاوب لكل من ديسكتوب وموبايل
- واجهة عربية كاملة مع تخطيط من اليمين لليسار
- نظام التصويت على إعادة اللعب مع بدء لحظي عند الموافقة
- شاشة نتائج محسنة مع رتب وحركات احتفال

**التطبيقات التقنية:**
- مؤقت حي مع تحديثات 100ms وTimeout 5 دقائق
- كشف الخسارة الفوري عند الوصول لأقصى عدد محاولات
- نظام إعادة اتصال قوي يستعيد كل حالة اللعبة
- تحديات صغيرة: "تحدي الذاكرة" و"تحدي الاتجاهات" و"تحدي حبات المطر" و"تحدي التخمين" مع تعليقات بصرية وسمعية وتنويعات موبايل/ديسكتوب
- نظام بطاقات فريد مع 6 أنواع وتأثيرات خاصة

## التبعيات الخارجية

**مكتبة مكونات الواجهة:**
- `@radix-ui/*`: مجموعة شاملة من العناصر الآمنة

**قاعدة البيانات والخادم:**
- `@neondatabase/serverless`, `drizzle-orm`, `drizzle-kit`, `ws`

**التصميم:**
- `tailwindcss`, `class-variance-authority`, `clsx`, `tailwind-merge`

**إدارة الحالة والبيانات:**
- `@tanstack/react-query`, `zustand`

**الوسائط والأصوات:**
- `@fontsource/inter`, `howler`, `react-confetti`

**أدوات التطوير:**
- `@replit/vite-plugin-runtime-error-modal`, `tsx`, `esbuild`, `vite`

## ملاحظات التطوير

### نقاط مهمة:
1. تأكد من أن الواجهات يمكن تمريرها عند اللعب
2. الأسهم في تحدي الاتجاهات معكوسة على الكمبيوتر (RTL) لكن صحيحة على الموبايل
3. الأخطاء تنقص الفرص من 3 إلى 2 إلى 1
4. نظام البطاقات حصري للعب الجماعي فقط
5. جميع النصوص يجب أن تكون بالعربية

### الملفات المهمة:
- `client/src/components/mobile/MobileSingleplayer.tsx`
- `client/src/components/desktop/DesktopSingleplayer.tsx`
- `client/src/components/game/challenges/`
- `client/src/lib/stores/useChallenges.ts`
- `client/src/lib/stores/useCards.ts`
- `server/routes.ts`
